<?php

/**
 * @author Marc MOREAU <moreau.marc.web@gmail.com>
 * @license https://github.com/MockingMagician/coinbase-pro-sdk/blob/master/LICENSE.md MIT
 * @link https://github.com/MockingMagician/coinbase-pro-sdk/blob/master/README.md
 */

namespace MockingMagician\CoinbaseProSdk\Tests\Unit\DTO;

use MockingMagician\CoinbaseProSdk\Functional\DTO\OracleCryptoSignedPricesData;
use MockingMagician\CoinbaseProSdk\Tests\CommonHelpers\TraitAssertMore;
use PHPUnit\Framework\TestCase;

/**
 * @covers \MockingMagician\CoinbaseProSdk\Functional\DTO\AbstractCreator
 * @covers \MockingMagician\CoinbaseProSdk\Functional\DTO\OracleCryptoSignedPricesData
 *
 * @internal
 */
class OracleCryptoSignedPricesDataTest extends TestCase
{
    use TraitAssertMore;

    public function provideValidJsonData()
    {
        return [
            [
                '{
                    "timestamp": "1601154840",
                    "messages": [
                        "0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000027f69cdd80000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034254430000000000000000000000000000000000000000000000000000000000",
                        "0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000001521c6570000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034554480000000000000000000000000000000000000000000000000000000000",
                        "0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000212cc600000000000000000000000000000000000000000000000000000000000000067072696365730000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000358545a0000000000000000000000000000000000000000000000000000000000",
                        "0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6fadb000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000f665c0000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034441490000000000000000000000000000000000000000000000000000000000",
                        "0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000f276500000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000035245500000000000000000000000000000000000000000000000000000000000",
                        "0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faedc00000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000607090000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000035a52580000000000000000000000000000000000000000000000000000000000",
                        "0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000038a170000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034241540000000000000000000000000000000000000000000000000000000000",
                        "0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000ff4600000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034b4e430000000000000000000000000000000000000000000000000000000000",
                        "0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000009c44a60000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044c494e4b00000000000000000000000000000000000000000000000000000000",
                        "0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000008a4fb70000000000000000000000000000000000000000000000000000000000000000670726963657300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004434f4d5000000000000000000000000000000000000000000000000000000000",
                        "0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000496862000000000000000000000000000000000000000000000000000000000000000670726963657300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003554e490000000000000000000000000000000000000000000000000000000000"
                    ],
                    "signatures": [
                        "0xa3d933bcfb6176379341bb7a328df46589ef9dcd1d8d7311515b4596c2d93e025b98f861a3a4bb95f6f13723edaab8cd33cd5ef46e096f3c99ca5512ba2aa254000000000000000000000000000000000000000000000000000000000000001c",
                        "0x72d41c083e173d7f92b2184ac749dc7500e8685b649ea0f007c6961b002ced1503b41133d482531853dd468d6d61c208ebe87dc3c2720ea4a77ca20a9adcf36f000000000000000000000000000000000000000000000000000000000000001c",
                        "0x212701313d2b6cae4b54e7f9f0179eca2d49059b5e2265b181ac88a10af50288e1d3ad7e1826dfe4a9a6aa1730fb723669541a26695764e1f0803f5b3976cf08000000000000000000000000000000000000000000000000000000000000001c",
                        "0x2895c5a3d0491be840e5802292f453bdb6b5f25e6d2709d1bdb2629c5f6a84ad7e3009a04a43b9b8a00049763dc3c5a3535b78af962f3baac0879f4cbea0be7e000000000000000000000000000000000000000000000000000000000000001c",
                        "0x0d4f75b04c08dbbc4e300277e3a962d8573202cb9a5175c55e35af26256b4a60568e045b4551e53aa17364e8674d0dc558b7281f1594f463fc76e5aed2421fa0000000000000000000000000000000000000000000000000000000000000001b",
                        "0xa0e20fdb8abe5e86175b3ace8e40979aecc1b8b1fb6e2a437a2c51378ab53471b9c00d60edf8b08f7cebf2eb4a185d4d56de6d27e83014be001fb2fc8f33e041000000000000000000000000000000000000000000000000000000000000001c",
                        "0x4d04943a138ab517e6c8a954f7d87dc403eb6e5ed36332cf6348353d4edf46328e1a9739f344fabcb7bf8d65481e9cfdba7360b16b27568ed32f8df2312c36e1000000000000000000000000000000000000000000000000000000000000001b",
                        "0x029f81cbe9ab92e2395b334e07963723a1352bedb93d5d79ee6179836b817cc210de7e20e96b6ec1120371349e8ba50c5381b0110fd456f7c2c95a9555f74c84000000000000000000000000000000000000000000000000000000000000001c",
                        "0xfc983ea23557075f271b97126bc1a392a174cd992249464c6c32a7579ef1b19cb0f19cbbc90a4b9f7c2fe1c11ef987becca5c9823d28cfa7595a38fc6c6bd0c8000000000000000000000000000000000000000000000000000000000000001c",
                        "0xadfb499a0ad869d006b02b412c63ba59cad486919ef59b047df901855852cec9d5a0ee3d54b3a967649e09d5d1d541d39c824f5677debf750bc00c14af1ff52f000000000000000000000000000000000000000000000000000000000000001b",
                        "0x3157e52678560189687ea8335833ff2ef6f750de72bf7b542e28b7c15be924cfb7e7ad4b043f6a974089f9ad7b6098326fd1c68c1985963e75d34c7a0a765f34000000000000000000000000000000000000000000000000000000000000001c"
                    ],
                    "prices": {
                        "BTC": "10727.575",
                        "ETH": "354.53499999999997",
                        "XTZ": "2.17415",
                        "DAI": "1.009244",
                        "REP": "15.89",
                        "ZRX": "0.395017",
                        "BAT": "0.231959",
                        "KNC": "1.0456",
                        "LINK": "10.24119",
                        "COMP": "145.03",
                        "UNI": "4.81085"
                    }
                }',
            ],
        ];
    }

    /**
     * @dataProvider provideValidJsonData
     */
    public function testCreateFromJson(string $json)
    {
        /** @var OracleCryptoSignedPricesData $oracleCryptoSignedPricesData */
        $oracleCryptoSignedPricesData = OracleCryptoSignedPricesData::createFromJson($json);
        self::assertInstanceOf(OracleCryptoSignedPricesData::class, $oracleCryptoSignedPricesData);
        self::assertEquals(1601154840, $oracleCryptoSignedPricesData->getTimestamp());
        self::assertEquals([
            '0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000027f69cdd80000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034254430000000000000000000000000000000000000000000000000000000000',
            '0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000001521c6570000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034554480000000000000000000000000000000000000000000000000000000000',
            '0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000212cc600000000000000000000000000000000000000000000000000000000000000067072696365730000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000358545a0000000000000000000000000000000000000000000000000000000000',
            '0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6fadb000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000f665c0000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034441490000000000000000000000000000000000000000000000000000000000',
            '0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000f276500000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000035245500000000000000000000000000000000000000000000000000000000000',
            '0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faedc00000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000607090000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000035a52580000000000000000000000000000000000000000000000000000000000',
            '0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000038a170000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034241540000000000000000000000000000000000000000000000000000000000',
            '0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000ff4600000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034b4e430000000000000000000000000000000000000000000000000000000000',
            '0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000009c44a60000000000000000000000000000000000000000000000000000000000000006707269636573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044c494e4b00000000000000000000000000000000000000000000000000000000',
            '0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000008a4fb70000000000000000000000000000000000000000000000000000000000000000670726963657300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004434f4d5000000000000000000000000000000000000000000000000000000000',
            '0x0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005f6faf1800000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000496862000000000000000000000000000000000000000000000000000000000000000670726963657300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003554e490000000000000000000000000000000000000000000000000000000000',
        ], $oracleCryptoSignedPricesData->getMessages());
        self::assertEquals([
            '0xa3d933bcfb6176379341bb7a328df46589ef9dcd1d8d7311515b4596c2d93e025b98f861a3a4bb95f6f13723edaab8cd33cd5ef46e096f3c99ca5512ba2aa254000000000000000000000000000000000000000000000000000000000000001c',
            '0x72d41c083e173d7f92b2184ac749dc7500e8685b649ea0f007c6961b002ced1503b41133d482531853dd468d6d61c208ebe87dc3c2720ea4a77ca20a9adcf36f000000000000000000000000000000000000000000000000000000000000001c',
            '0x212701313d2b6cae4b54e7f9f0179eca2d49059b5e2265b181ac88a10af50288e1d3ad7e1826dfe4a9a6aa1730fb723669541a26695764e1f0803f5b3976cf08000000000000000000000000000000000000000000000000000000000000001c',
            '0x2895c5a3d0491be840e5802292f453bdb6b5f25e6d2709d1bdb2629c5f6a84ad7e3009a04a43b9b8a00049763dc3c5a3535b78af962f3baac0879f4cbea0be7e000000000000000000000000000000000000000000000000000000000000001c',
            '0x0d4f75b04c08dbbc4e300277e3a962d8573202cb9a5175c55e35af26256b4a60568e045b4551e53aa17364e8674d0dc558b7281f1594f463fc76e5aed2421fa0000000000000000000000000000000000000000000000000000000000000001b',
            '0xa0e20fdb8abe5e86175b3ace8e40979aecc1b8b1fb6e2a437a2c51378ab53471b9c00d60edf8b08f7cebf2eb4a185d4d56de6d27e83014be001fb2fc8f33e041000000000000000000000000000000000000000000000000000000000000001c',
            '0x4d04943a138ab517e6c8a954f7d87dc403eb6e5ed36332cf6348353d4edf46328e1a9739f344fabcb7bf8d65481e9cfdba7360b16b27568ed32f8df2312c36e1000000000000000000000000000000000000000000000000000000000000001b',
            '0x029f81cbe9ab92e2395b334e07963723a1352bedb93d5d79ee6179836b817cc210de7e20e96b6ec1120371349e8ba50c5381b0110fd456f7c2c95a9555f74c84000000000000000000000000000000000000000000000000000000000000001c',
            '0xfc983ea23557075f271b97126bc1a392a174cd992249464c6c32a7579ef1b19cb0f19cbbc90a4b9f7c2fe1c11ef987becca5c9823d28cfa7595a38fc6c6bd0c8000000000000000000000000000000000000000000000000000000000000001c',
            '0xadfb499a0ad869d006b02b412c63ba59cad486919ef59b047df901855852cec9d5a0ee3d54b3a967649e09d5d1d541d39c824f5677debf750bc00c14af1ff52f000000000000000000000000000000000000000000000000000000000000001b',
            '0x3157e52678560189687ea8335833ff2ef6f750de72bf7b542e28b7c15be924cfb7e7ad4b043f6a974089f9ad7b6098326fd1c68c1985963e75d34c7a0a765f34000000000000000000000000000000000000000000000000000000000000001c',
        ], $oracleCryptoSignedPricesData->getSignatures());
        self::assertEquals([
            'BTC' => '10727.575',
            'ETH' => '354.53499999999997',
            'XTZ' => '2.17415',
            'DAI' => '1.009244',
            'REP' => '15.89',
            'ZRX' => '0.395017',
            'BAT' => '0.231959',
            'KNC' => '1.0456',
            'LINK' => '10.24119',
            'COMP' => '145.03',
            'UNI' => '4.81085',
        ], $oracleCryptoSignedPricesData->getPrices());
    }
}
